<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Mental Health Resources - MindBloom</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/common/layout.css}">
    <link rel="stylesheet" th:href="@{/css/counselor/resources.css}">
</head>
<body>
<div class="layout">
    <div th:replace="fragments/counselor-navbar :: counselor-navbar"></div>
    <main class="main-content">
        <div class="container-fluid px-0">
            <!-- PAGE HERO (Purple gradient) -->
            <section class="page-hero">
                <div class="hero-content">
                    <h1>Mental Health Resources</h1>
                    <p>Manage all mental health learning materials</p>
                </div>
                <a th:href="@{/counselor/resources/add}" class="btn btn-light">
                    <i class="bi bi-plus-lg me-1"></i> Add New Resource
                </a>
            </section>

            <!-- ACTION BAR -->
            <div class="actions-bar">
                <form method="get" th:action="@{/counselor/resources}">
                    <input type="text" name="search" class="form-control" placeholder="Search by title" th:value="${param.search}">
                    <select name="category" class="form-select" onchange="this.form.submit()">
                        <option value="">All Categories</option>
                        <option value="Awareness" th:selected="${selectedCategory == 'Awareness'}">Awareness</option>
                        <option value="Self-Care" th:selected="${selectedCategory == 'Self-Care'}">Self-Care</option>
                        <option value="Coping Strategies" th:selected="${selectedCategory == 'Coping Strategies'}">Coping Strategies</option>
                        <option value="Treatment" th:selected="${selectedCategory == 'Treatment'}">Treatment</option>
                        <option value="Crisis Support" th:selected="${selectedCategory == 'Crisis Support'}">Crisis Support</option>
                    </select>
                </form>
            </div>

            <!-- TABLE -->
            <div class="resource-table-wrapper" th:if="${!resources.isEmpty()}">
                <div class="table-responsive">
                    <table class="table resource-table">
                        <thead>
                        <tr>
                            <th>Title</th>
                            <th>Category</th>
                            <th>Type</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="res : ${resources}">
                            <td class="title-cell" th:text="${res.title}"></td>
                            <td>
                                <span class="category-badge" 
                                      th:classappend="${res.category == 'Awareness'} ? 'badge-awareness' : 
                                                      (${res.category == 'Self-Care'} ? 'badge-selfcare' : 
                                                      (${res.category == 'Coping Strategies'} ? 'badge-coping' : 
                                                      (${res.category == 'Treatment'} ? 'badge-treatment' : 'badge-crisis')))"
                                      th:text="${res.category}"></span>
                            </td>
                            <td th:text="${#strings.capitalize(res.type.toLowerCase())}"></td>
                            <td th:text="${#temporals.format(res.createdAt, 'dd MMM yyyy')}"></td>
                            <td class="action-cell">
                                <a th:href="@{/counselor/resources/edit/{id}(id=${res.id})}" class="btn btn-sm btn-outline-primary">Edit</a>
                                <a th:href="@{/counselor/resources/delete/{id}(id=${res.id})}" onclick="return confirm('Delete this resource?')" class="btn btn-sm btn-outline-danger">Delete</a>
                                <a th:if="${!assessmentMap[res.id]}" th:href="@{/counselor/resources/{id}/assessment/add(id=${res.id})}" class="btn btn-sm btn-add-assessment">Add Assessment</a>
                                <a th:if="${assessmentMap[res.id]}" th:href="@{/counselor/resources/{id}/assessment/add(id=${res.id})}" class="btn btn-sm btn-manage-assessment">Manage Assessment</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- EMPTY STATE -->
            <div class="empty-state" th:if="${resources.isEmpty()}">
                <p>No resources found. <a th:href="@{/counselor/resources/add}">Add your first resource</a></p>
            </div>
        </div>
    </main>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
