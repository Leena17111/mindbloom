<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Mental Health Resources</title>
    <link rel="stylesheet" th:href="@{/css/common/base.css}">
    <link rel="stylesheet" th:href="@{/css/common/layout.css}">
    <link rel="stylesheet" th:href="@{/css/counselor/resources.css}">
</head>

<body>
<div class="layout">

    <!-- Counselor Navbar -->
    <div th:replace="fragments/counselor-navbar :: counselor-navbar"></div>

    <main class="main-content">

        <div class="page-header">
            <h1>Mental Health Resources</h1>
            <p>Manage all mental health learning materials</p>
        </div>

        <div class="actions-bar">
    <form method="get" th:action="@{/counselor/resources}">

        <input type="text"
               name="search"
               placeholder="Search by title"
               th:value="${param.search}">

        <select name="category" onchange="this.form.submit()">
        <option value="">All Categories</option>

        <option value="Awareness"
            th:selected="${selectedCategory == 'Awareness'}">
            Awareness
        </option>

        <option value="Self-Care"
            th:selected="${selectedCategory == 'Self-Care'}">
            Self-Care
        </option>

        <option value="Coping Strategies"
            th:selected="${selectedCategory == 'Coping Strategies'}">
            Coping Strategies
        </option>

        <option value="Treatment"
            th:selected="${selectedCategory == 'Treatment'}">
            Treatment
        </option>

        <option value="Crisis Support"
            th:selected="${selectedCategory == 'Crisis Support'}">
            Crisis Support
        </option>
    </select>

            </form>

            <a th:href="@{/counselor/resources/add}" class="btn-primary">
                + Add New Resource
            </a>
        </div>

        <!-- Table -->
        <table class="resource-table" th:if="${!resources.isEmpty()}">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Type</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>

            <tbody>
                <tr th:each="res : ${resources}">
                    <td th:text="${res.title}"></td>
                    <td th:text="${res.category}"></td>
                    <td th:text="${#strings.capitalize(res.type.toLowerCase())}"></td>
                    <td th:text="${#temporals.format(res.createdAt, 'dd MMM yyyy')}"></td>

                    <td class="action-cell">
                        <a th:href="@{/counselor/resources/edit/{id}(id=${res.id})}"
                           class="btn-edit">Edit</a>

                        <a th:href="@{/counselor/resources/delete/{id}(id=${res.id})}"
                           onclick="return confirm('Delete this resource?')"
                           class="btn-delete">
                           Delete
                        </a>

                        <!-- ADD ASSESSMENT -->
                    <a th:if="${!assessmentMap[res.id]}"
                    th:href="@{/counselor/resources/{id}/assessment/add(id=${res.id})}"
                    class="btn-assessment">
                    Add Assessment
                    </a>

                    <!-- MANAGE ASSESSMENT -->
                    <a th:if="${assessmentMap[res.id]}"
                    th:href="@{/counselor/resources/{id}/assessment/add(id=${res.id})}"
                    class="btn-assessment-manage">
                    Manage Assessment
                    </a>

                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Empty State -->
        <div class="empty-state" th:if="${resources.isEmpty()}">
            <p>No resources found.
               <a th:href="@{/counselor/resources/add}">Add your first resource</a>
            </p>
        </div>

    </main>
</div>
</body>
</html>
